<!-- Wappler include head-page="layouts/main" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="form1" appconnect="local" components="{dmxBootstrap5TableGenerator:{},dmxFormatter:{},dmxDataTraversal:{},dmxBootstrap5PagingGenerator:{},dmxDatastore:{},dmxFormRepeat:{},dmxStateManagement:{},dmxNotifications:{},dmxBootstrap5Modal:{},dmxValidator:{}}" -->
<dmx-datastore id="datastore1"></dmx-datastore>
<dmx-toggle id="toggle_for_FactureRecherche_Page"></dmx-toggle>
<script is="dmx-flow" id="flow1" type="text/dmx-flow" autorun="true">{
  run: {outputType: "text", action: "{{datastore1.clear()}}"}
}</script>
<dmx-json-datasource id="table_valeur" is="dmx-serverconnect" url="/table_valeurs.json"></dmx-json-datasource>
<dmx-value id="varLiquide"></dmx-value>
<dmx-value id="varCheque"></dmx-value>
<dmx-toggle id="toggle_for_dropMenu"></dmx-toggle>
<dmx-toggle id="toggle1"></dmx-toggle>
<dmx-value id="id_contrat"></dmx-value>

<div class="modal" id="modal_recherche_facture" is="dmx-bs5-modal" tabindex="-1" nobackdrop="true" dmx-on:keypress="" dmx-show="">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title text-primary">Recherche Facture</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" dmx-on:keypress="">
                <!-- Wappler include head-page="layouts/main" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="Recherche_facture" appConnect="local" components="{dmxBootstrap5TableGenerator:{},dmxValidator:{},dmxFormatter:{}}" -->
                <dmx-serverconnect id="tout_utlisateur" url="/api/Visualisation/Tout_Utilisateur"></dmx-serverconnect>
                <dmx-json-datasource id="type_mvt" is="dmx-serverconnect" url="/type_Mvt.json"></dmx-json-datasource>

                <script src="https://momentjs.com/downloads/moment.js"></script>
                <dmx-serverconnect id="Server_Recherche" url="/api/Visualisation/Recherche_Facture" noload="true"></dmx-serverconnect>

                <meta name="ac:route" content="/Encaissement/ENC_Diver_Multiple">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12 text-bg-light pt-2">
                            <div class="row">
                                <div class="col-5 small">
                                    <form id="form4">
                                        <div class="form-group mb-3 row">
                                            <label for="input_NClient" class="col-sm-1 col-form-label col-form-label-sm style251 pe-0">Nom Client</label>
                                            <label for="input_NClient" class="col-sm-2 col-form-label style271 col-form-label-sm"></label>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-4 small lh-1">
                                    <form id="form5">
                                        <div class="form-group mb-1 row">
                                            <label for="input_NClient" class="col-sm-1 col-form-label col-form-label-sm style251 pe-0">N Client :</label>
                                            <div class="col-sm-6">
                                                <input type="text" class="form-control form-control-sm" id="input_NClient" name="input4" aria-describedby="input1_help">
                                            </div>
                                        </div>

                                    </form>
                                </div>


                            </div>

                            <div class="row small">
                                <div class="mb-1 pe-0 ml-1 col-3 small">
                                    <form id="form1">
                                        <div class="form-group mb-1 row">
                                            <label for="input_NSupport" class="col-sm-1 col-form-label col-form-label-sm style251 pe-0">Nom Support :</label>
                                            <div class="col-sm-5">
                                                <input type="text" class="form-control form-control-sm" id="input_NSupport" name="input1" aria-describedby="input1_help">
                                            </div>
                                        </div>
                                        <div class="form-group mb-1 row">
                                            <label for="input_Cnt" class="col-sm-1 col-form-label col-form-label-sm style251 pe-0">N' Compteur :&nbsp;</label>
                                            <div class="col-sm-5">
                                                <input type="text" class="form-control form-control-sm" id="input_Cnt" name="input2" aria-describedby="input2_help">
                                            </div>
                                        </div>

                                    </form>

                                </div>
                                <div class="ps-0 mb-1 ml-1 col-3 small">
                                    <form id="form2">
                                        <div class="form-group mb-1 row">
                                            <label for="input_Ncnt" class="col-sm-1 col-form-label col-form-label-sm style251 pe-0" style="font-size: ;">N Contrat :</label>
                                            <div class="col-sm-5">
                                                <input type="text" class="form-control form-control-sm" id="input_Ncnt" name="input3" aria-describedby="input1_help">
                                            </div>
                                        </div>
                                        <div class="form-group mb-1 row">
                                            <label for="input_Ncnt" class="col-sm-1 col-form-label col-form-label-sm style251 pe-0">N' Facture :&nbsp;</label>
                                            <div class="col-sm-5">
                                                <input type="text" class="form-control form-control-sm" id="input_NFact" name="input3" aria-describedby="input2_help">
                                            </div>
                                        </div>

                                    </form>

                                </div>
                                <div class="ps-0 mb-1 ml-1 col-5 small">
                                    <form id="form3">
                                        <div class="form-group mb-1 row style253">

                                            <label for="input_NClient" class="col-sm-1 col-form-label col-form-label-sm style251 pe-0">date d'emissiom De:</label>
                                            <div class="col-1 pe-0">
                                                <div class="form-check style255">
                                                    <input class="form-check-input pe-0" type="checkbox" value="" id="checkbox_de" name="input5">
                                                </div>
                                            </div>




                                            <div class="ps-0 col-sm-3">

                                                <input id="date_De" name="date1" is="dmx-date-picker" class="style252" dmx-bind:disabled="!checkbox_de.checked">
                                            </div>
                                            <label for="input_NClient" class="col-sm-1 ms-3">à</label>
                                            <div class="pe-0 col-1">
                                                <div class="form-check style255">
                                                    <input class="form-check-input pe-0" type="checkbox" value="" id="checkbox_a" name="input6">
                                                </div>
                                            </div>
                                            <div class="col-sm-1 ps-0">
                                                <input id="date_A" name="date2" is="dmx-date-picker" class="style252" dmx-bind:disabled="!checkbox_a.checked">
                                            </div>
                                        </div>

                                        <div class="form-group mb-1 row style259">
                                            <label for="input_NClient" class="col-sm-1 col-form-label col-form-label-sm style251 pe-0">Par utlisateur</label>
                                            <div class="col-6"><select id="select_Utilisateur" class="form-select form-select-sm style256 ps-0" dmx-bind:options="tout_utlisateur.data.custom" optiontext="lib" optionvalue="matricule">
                                                </select></div>
                                        </div>
                                        <div class="form-group mb-1 row style259">
                                            <label for="input_NClient" class="col-sm-1 col-form-label col-form-label-sm style251 pe-0">Mvt. portefeuile :</label>
                                            <div class="col-6"><select id="select_Mvt" class="form-select form-select-sm style256 ps-0" dmx-bind:options="type_mvt.data.NewDataSet.tv" optiontext="LIBELLE_TYPE_MVT" optionvalue="ID_TYPE_MVT">
                                                    <option selected="" value=""></option>
                                                </select></div>
                                        </div>

                                    </form>

                                </div>



                            </div>
                            <div class="row pt-0 pb-0 small lh-1">
                                <div class="small lh-1 col-5 text-start fw-bold">
                                    <div is="dmx-radio-group" id="group1" class="radio-group" style="font-size: 10px;">
                                        <div class="form-check style146 form-check-inline col-3" style="margin-right: 0px;"><input class="form-check-input" type="radio" value="1" id="R_NonPayee" name="transaction_type" checked="">
                                            <label class="form-check-label" for="R_NonPayee">Non payees</label>
                                        </div>
                                        <div class="form-check form-check-inline col-2" style="margin-left: 0px;">
                                            <input class="form-check-input" type="radio" value="2" id="R_Payee" name="transaction_type">
                                            <label class="form-check-label " for="R_Payee">Payees</label>
                                        </div>
                                        <div class="form-check form-check-inline style148 offset-1 col-5" style="margin-left: 0px;">
                                            <input class="form-check-input" type="radio" value="3" id="R_Payee_NonPay" name="transaction_type">
                                            <label class="form-check-label " for="R_Payee_NonPay">Payees&amp;Non Payees</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="small lh-1 col-7 text-center fw-bold">
                                    <div is="dmx-radio-group" id="group2" class="radio-group">
                                        <div class="form-check form-check-inline style146 col-2"><input class="form-check-input" type="radio" value="1" id="r_annulee" name="transaction_type1" checked="">
                                            <label class="form-check-label " for="r_annulee" style="font-size: 10px;margin-right: 0px;">Annulees</label>
                                        </div>
                                        <div class="form-check form-check-inline col-2">
                                            <input class="form-check-input" type="radio" value="2" id="R_NonAnnulee" name="transaction_type1">
                                            <label class="form-check-label " for="r_annulee" style="font-size: 10px; margin-left: 0px;">Non annulees</label>
                                        </div>
                                        <div class="form-check style148 form-check-inline col-3">
                                            <input class="form-check-input pe-0" type="radio" value="3" id="R_annule_Nonanulee" name="transaction_type1">
                                            <label class="form-check-label col ps-0" for="r_annulee" style="font-size: 10px; margin-left: 0px; /* padding-left: 2px !important */">Annulees&amp;Non annulees</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">




                                <div class="row bg-secondary mt-1">
                                    <div class="col-6 mt-1 mb-1">
                                        <div is="dmx-radio-group" id="group3" class="radio-group">
                                            <div class="form-check form-check-inline style146 col-2"><input class="form-check-input" type="radio" value="1" id="sans_Anomalie" name="transaction_type2" checked="">
                                                <label class="form-check-label style143" for="sans_Anomalie">Sans anomalie</label>
                                            </div>
                                            <div class="form-check form-check-inline style147 col-1">
                                                <input class="form-check-input" type="radio" value="2" id="anomalie" name="transaction_type2">
                                                <label class="form-check-label style144" for="anomalie">En anomalie</label>
                                            </div>
                                            <div class="form-check col-3 form-check-inline style148">
                                                <input class="form-check-input" type="radio" value="3" id="Toutes" name="transaction_type2">
                                                <label class="form-check-label style145" for="Toutes">Toutes</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-end col-6 mt-1 mb-1">
                                        <button id="btn_Recherche" class="btn text-light w-25 bg-primary btn-sm" dmx-on:click="run([{runJS:{outputType:'text',function:'rechrcheavance_txt'}},{condition:{outputType:'boolean',if:`content.searchCritique.value!=\'\'`,then:{steps:{run:{outputType:'text',action:`Server_Recherche.load({arg_sonutilisation: 1, arg_criteriasearch: searchCritique.value.replace(\'&quot;\', \'\\\'\').uppercase()})`}}}}}])">
                                            <span class="spinner-border spinner-border-sm" role="status" dmx-show="Server_Recherche.state.executing"></span>Rechercher</button>
                                        <button id="btn_Effacer" class="btn text-bg-light w-25 btn-outline-secondary btn-sm">Effacer</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="col small lh-1">
                            <div class="table-responsive mb-2 pb-1 style268 small lh-1" style="height: 450px ; overflow: auto;">
                                <table class="table table-striped table-hover style156 table-bordered small lh-1">
                                    <thead style=" background: #F0F0F1;position: -webkit-sticky; position: sticky; top: 0;  z-index: 1200;" class="table-muted small">
                                        <tr>
                                            <th>Num facture</th>
                                            <th>Date emission</th>
                                            <th>Num contrat</th>
                                            <th>Nom</th>
                                            <th>Montant</th>
                                            <th>Nro lettrage</th>

                                        </tr>
                                    </thead>
                                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="Server_Recherche.data.custom" id="tableRepeat2" class="small">
                                        <tr dmx-class:table-danger="nro_lettrage=='N'" dmx-on:click="form5.input_NClient.setValue(num_facture);modal_recherche_facture.toggle()">
                                            <td dmx-text="num_facture"></td>
                                            <td dmx-text="date_emission"></td>
                                            <td dmx-text="num_contrat"></td>
                                            <td dmx-text="nom"></td>
                                            <td dmx-text="montant"></td>
                                            <td dmx-text="nro_lettrage"></td>

                                        </tr>
                                    </tbody>

                                </table>
                            </div>
                        </div>
                        <div class="col-10 d-flex style157 small lh-1">
                            <span><i class="far fa-square style152"></i>&nbsp; &nbsp;Paye &nbsp; &nbsp; </span>
                            <span class="style151"><i class="far fa-square style150"></i>&nbsp; &nbsp;Non Paye</span>
                        </div>



                    </div>
                </div>



                <script>
                    var condition = '';
    function myfunction() {
  // Your code here
 //console.log( dmx.app.data.content.searchCritique.value)
     console.log(dmx.app.data.content.vartypesearch.value);
}
function rechrcheavance_txt()
{
    if (dmx.app.data.content.var_utlisateur.value.value=1)
    {
       condition = 'where'

    }else 
    {
        condition = 'and'
    }

      dmx.app.data.content.searchCritique.value = '';
    if ( document.getElementById('checkbox_de').checked ||  document.getElementById('checkbox_a').checked)
      {
        if ( document.getElementById('checkbox_de').checked )
        {
            var td = " "
            td = moment(document.getElementById('date_De').value.toString()).format("DD/MM/YYYY").toString()

            dmx.app.data.content.searchCritique.value += condition + ' TRUNC(FT.DATE_EMISSION) >= TO_DATE("' +  td.toString() + '")';

            condition = 'and';
        }

        if (document.getElementById('checkbox_a').checked  )
        {
             var td = moment( document.getElementById('date_A').value,"DD/MM/YYYY").toString()

         dmx.app.data.content.searchCritique.value += condition +  ' TRUNC(FT.DATE_EMISSION) >= TO_DATE("' + td.toString() + '")';
             condition = 'and';
        }
      }

     if (document.getElementById('select_Utilisateur').value != -1 && document.getElementById('select_Mvt').value !=  0 )
        {
          dmx.app.data.content.searchCritique.value +=  condition + '  FT.USER_MAJ ='  +  document.getElementById('select_Utilisateur').value + ' and FT.USER_MAJ IS NOT  NULL  '; 

          condition = 'and';
        }

        if (document.getElementById('select_Mvt').value != -1 && document.getElementById('select_Mvt').value !=  0 )
        {
          dmx.app.data.content.searchCritique.value +=  condition + ' FT.TYPE_MVT_PORTEFEUILLE ='  +  document.getElementById('select_Mvt').value + ' and FT.TYPE_MVT_PORTEFEUILLE IS NOT NULL  '; 

          condition = 'and';
        }

   if (  document.getElementById('r_annulee').checked )

       {
          dmx.app.data.content.searchCritique.value +=  condition + '  FT.ANNULATION = "O" '; 
          condition = 'and';
       }

    if (  document.getElementById('R_NonAnnulee').checked )
    {
          dmx.app.data.content.searchCritique.value +=  condition + ' FT.ANNULATION = "N" '; 

          condition = 'and';
    }
    if (  document.getElementById('R_Payee').checked )
    {
          dmx.app.data.content.searchCritique.value += condition + ' FT.NRO_LETTRAGE IS NOT NULL '; 
          condition = 'and';
    }

    if (  document.getElementById('R_NonPayee').checked )
    {
          dmx.app.data.content.searchCritique.value += condition + ' FT.NRO_LETTRAGE IS NULL '; 

          condition = 'and';
    }

    if (  document.getElementById('sans_Anomalie').checked )
    {
          dmx.app.data.content.searchCritique.value +=  condition + '  FT.ANO_FACT="N" '; 

          condition = 'and';
    }
     if (  document.getElementById('anomalie').checked )
    {
          dmx.app.data.content.searchCritique.value +=  condition +  '  FT.ANO_FACT="O" '; 

          condition = 'and';
    }

    
     if ( document.getElementById('input_Cnt').value.length != 0) 
     {
         dmx.app.data.content.searchCritique.value +=  condition +'  FT.CODE_COMPTEUR = ' + document.getElementById('input_Cnt').value; 
         condition = 'and';
         console.log(dmx);
     }
     if ( document.getElementById('input_NFact').value.length != 0) 
     {
         dmx.app.data.content.searchCritique.value += condition + '  FT.NUM_FACTURE =  ' + document.getElementById('input_NFact').value; 

         condition = 'and';
     }
      if ( document.getElementById('input_NSupport').value.length != 0) 
     {
         dmx.app.data.content.searchCritique.value +=  condition + '   SUBSTR(FT.CODE_PL_PHYS,3,5)  =  ' + document.getElementById('input_NSupport').value; 

         condition = 'and';
     }
      if ( document.getElementById('input_Ncnt').value.length != 0) 
      {
         dmx.app.data.content.searchCritique.value +=  condition +'  FT.NUM_CONTRAT = ' + document.getElementById('input_Ncnt').value; 

         condition = 'and';
      }

      if ( document.getElementById('input_NClient').value.length != 0) 
     {
         dmx.app.data.content.searchCritique.value +=  condition +'  FT.ID_PAYEUR = ' + document.getElementById('input_NClient').value; 

         condition = 'and';
     }
}

    //console.log(dmx.app.data.content.searchCritique.value);


// console.log(dmx.app.data.content.searchCritique.value);

                </script>
            </div>
            <div class="modal-footer ">
                <div align="left" class="style163">

                    <div class="d-flex  style164">
                        <button type="button" class="btn btn-secondary style161 btn-sm" data-bs-dismiss="modal">Close</button>
                    </div>


                </div>





            </div>
        </div>
    </div>
</div>
<div class="modal" id="modal1" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h3 class="modal-title text-primary">Encaissement Divers&nbsp;</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h4><i class="far fa-question-circle fa-2x"></i>&nbsp;voulez vous vraiment valider l'Encaissement ?&nbsp;</h4>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary w-25" dmx-on:click="run({condition:{outputType:'boolean',if:`input5.checked`,then:{steps:[{run:{outputType:'text',action:`modal1.toggle()`}},{runJS:{outputType:'text',function:'loadOtherPage'}},{run:{outputType:'text',action:`browser1.goto(\'/Report/RecuReport\')`}}]},else:{steps:[{run:{outputType:'text',action:`serverSpEncaissement.load({id_contrat: input1.value, argmt_cash: montantLiquide.value, argmt_cheque: 0, argno_doc: NroDoc.value, argbanque: banque.value, argusermaj: 47433, argmvtpaye_tx: varListFactures.value, argmode_paimnt: Mode_Paiment.value, arg_checkassign: affecterMvtCheck.checked.then(true, false), arg_totcr: montantLiquide.value, arg_nomfenetre: \'frmautrecashmvmt2\'});modal1.form1.reset()`}},{runJS:{outputType:'text',function:'load'}},{run:{outputType:'text',action:`modal1.toggle()`}}]}}})" dmx-bind:disabled="form1.input3.value+' '-form1.total.value+' '&lt;0" id="BtnOui">Oui</button><button id="btnNon" class="btn w-25 btn-primary" dmx-on:click="browser1.goto('/Report/RecuReport',true)">Nom</button>

            </div>
        </div>
    </div>
</div>

<dmx-notifications id="notifies1"></dmx-notifications>
<dmx-serverconnect id="SP_encaissement" url="/api/Encaisement_Batch/sp_encaissement_batch" dmx-param:id_piece="" noload="true"></dmx-serverconnect>
<dmx-value id="VarListFactures"></dmx-value>
<dmx-local-manager id="local1"></dmx-local-manager>
<dmx-serverconnect id="listBanque" url="/api/Encaisement_Batch/ListBanque"></dmx-serverconnect>
<dmx-serverconnect id="liste_Factures" url="/api/Encaisement_Batch/header_list_FC" dmx-param:id_contrat="id_piece.value.toNumber()" dmx-param:checked="2" dmx-param:id_ligeno="id_ligno.value" noload="true" dmx-on:done="datastore1.upsert({$id: liste_Factures.data.api.data[0].trid},{N_Piece: liste_Factures.data.api.data[0].trid, Date_emission: liste_Factures.data.api.data[0].date_emission, Type_Mouvement: liste_Factures.data.api.data[0].libelle_type_mvt, Debit: liste_Factures.data.api.data[0].debit, Credit: liste_Factures.data.api.data[0].credit, Montant: liste_Factures.data.api.data[0].montant})"></dmx-serverconnect>

<div class="border-secondary container-fluid">
    <div class="row pb-0" style="height : 90vh">
        <div class="rounded-1 border-dark style84 mw-100 ps-0 pe-0 col-3 h-100">
            <div class="card h-100">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <form id="form7">
                            <div class="row">
                                <div class=" w-auto border-2 border-dark rounded small lh-1 col">



                                    <div is="dmx-radio-group" id="group4" class="radio-group">
                                        <input id="radio_Facture" name="radio1" type="radio" dmx-on:click="toggle1.uncheck()">
                                        <label class="form-check-label style216 col-form-label-sm" for="radio_facture">&nbsp;Facture&nbsp; &nbsp;&nbsp;</label>
                                        <input id="radio_AutrMvt" name="radio1" type="radio" dmx-on:click="toggle1.check()">
                                        <label class="form-check-label style217 col-form-label-sm" for="Radi_autre_mvt">Autre_Mvt</label>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </li>
                </ul>
                <div class="card-body bg-light pt-1 pe-0">
                    <form id="form6" class="style291">
                        <div class="form-group mb-1 row style290 style275 text-end">
                            <!-- Added text-end for right alignment -->
                            <label for="id_piece" class="col-sm-2 col gx-5 style106 col-form-label-sm ps-0 pe-0">
                                <b>N°Piece :</b>
                            </label>
                            <div class="gx-1 style95 small lh-1 col-sm-4 ms-auto pe-0">
                                <!-- Added ms-auto for right alignment -->
                                <input type="number" class="form-control form-control-sm" id="id_piece" name="id_piece" aria-describedby="input1_help" is="dmx-input" value="">
                            </div>
                            <div class="gx-1 style95 border-2 rounded border-black small lh-1 col-sm-1 ps-0 pe-0">
                                <input type="number" class="form-control style119 form-control-sm ps-0" id="id_ligno" name="id_ligno" aria-describedby="input1_help" placeholder="" is="dmx-input" value="1" dmx-show="toggle1.checked">
                            </div>
                            <div class="style96 small lh-1 ps-0 offset-2 col-3 ms-auto text-end">
                                <!-- Added ms-auto and text-end here -->
                                <button id="btn_ok" class="btn btn-outline-secondary bg-primary text-white btn-sm style218 small lh-1" is="dmx-button" value="" type="button" dmx-on:click="liste_Factures.load({arg_npiece: id_piece.value, arg_nonfenetre: '\'frmautrecashmvmt2\'', arg_nroligne: 0})">
                                    <span class="spinner-border spinner-border-sm" role="status" dmx-show="liste_Factures.state.executing"></span>
                                    <b>ok</b>&nbsp;
                                </button>
                                <button id="btn_Reche" class="btn btn-outline-secondary btn-sm small lh-1" is="dmx-button" value="" type="button" data-bs-toggle="modal" data-bs-target="#modal_recherche_facture" dmx-on:click="toggle_for_FactureRecherche_Page.toggle()">...</button>
                            </div>
                        </div>
                    </form>
                    <div class="row">

                        <ul class="dropdown-menu dropdown-menu-end dropup" role="menu" dmx-show="toggle_for_dropMenu.checked" dmx-on:contextmenu="">
                            <a class="dropdown-item" href="#" dmx-on:click="input_MontantLiquide.setValue(input_MontantTotal.value)"> jfjfjgfujgi Liquide</a>
                            <a class="dropdown-item" href="#" dmx-on:click="input_MonatantCheque.setValue(input_MontantTotal.value)">Cheque</a>

                        </ul>
                    </div>
                    <div class="row border-1 rounded border-dark-subtle row-cols-1 ps-0">
                        <div class="col lh-lg mt-2 ps-0 text-start">

                            <ul class="list-group" style="background-color: whitesmoke; align-content: left;">
                                <li class="list-group-item bg-light" style="border: none; font-size: 12px;">

                                    <b>N° PL : &nbsp; &nbsp; &nbsp; &nbsp; <h6 style="color: blue; display: inline;">{{liste_Factures.data.api.data[0].codepl}}</h6></b>
                                </li>
                                <li class="list-group-item bg-light" style="border: none; font-size: 12px;"><b>N° Contrat : &nbsp; &nbsp; &nbsp; &nbsp; <h6 style="color: blue; display: inline;">{{liste_Factures.data.api.data[0].id_contrat}}</h6></b></li>
                                <li class="list-group-item bg-light" style="border: none; font-size: 12px;">
                                    <b>Nom: </b>&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;<h6 style="color: blue; display: inline;">{{liste_Factures.data.api.data[0].solde_compte}}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <h6 style="color: blue; display: inline;" class="blink">{{liste_Factures.data.api.data[0].sens}}</h6>
                                    </h6>
                                </li>
                                <li class="list-group-item bg-light" style="border: none; font-size: 12px;">
                                    <b>Date Echeance : &nbsp; &nbsp;&nbsp; &nbsp;<h6 style="color: blue; display: inline;"> {{liste_Factures.data.api.data[0].date_echeance.toDate().formatDate('dd/MM/yyyy')}}</h6></b>
                                </li>
                                <li class="list-group-item bg-light" style="border: none; font-size: 12px;"><b>Date Emission: &nbsp; &nbsp;&nbsp; &nbsp; <h6 style="color: blue; display: inline;">{{liste_Factures.data.api.data[0].date_emission.toDate().formatDate('dd/MM/yyyy')}}</h6></b></li>
                                <li class="list-group-item bg-light" style="border: none; font-size: 12px;">
                                    <b>Montant : &nbsp; &nbsp;&nbsp; &nbsp;<h6 style="color: blue; display: inline;"> {{liste_Factures.data.api.data[0].montant}}</h6></b>
                                </li>

                                <li class="list-group-item bg-light" style="border: none; font-size: 12px;">
                                    <b>Solde : &nbsp; &nbsp;&nbsp; &nbsp; <h6 style="color: blue; display: inline;"> {{liste_Factures.data.api.data[0].solde_compte}}</h6></b>
                                </li>

                            </ul>

                        </div>



                    </div>

                </div>
            </div>
        </div>
        <div class="ps-1 pe-0 style260 col-9 h-100" style="flex-direction: column; height: 100vh">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex">
                        <div class="card w-100" style="height: 78vh">
                            <div class="card-body pt-0 ps-0 pe-0">
                                <div class="row small fw-bolder ms-0 me-0 pt-0 bg-light"><small class="text-muted ">Mouvement Non Affectees</small>

                                </div>
                                <div class="table-responsive style209 small lh-1" style="height :75vh; overflow-y: auto;">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-sm">
                                            <thead>
                                                <tr class="table-secondary">
                                                    <th>N°piece</th>
                                                    <th>Date emission</th>
                                                    <th>Type mouvement</th>
                                                    <th>Debit</th>
                                                    <th>Credit</th>
                                                    <th>Montant</th>
                                                </tr>
                                            </thead>
                                            <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="datastore1.data" id="tableRepeat1">
                                                <tr>
                                                    <td dmx-text="N_Piece"></td>
                                                    <td dmx-text="Date_emission"></td>
                                                    <td dmx-text="Type_Mouvement"></td>
                                                    <td dmx-text="Debit"></td>
                                                    <td dmx-text="Credit"></td>
                                                    <td dmx-text="Montant"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>



                                    <table class="table" id="table2" dmx-show="!serverListesFactures.data.api.data.queryListFactures.hasItems()">
                                        <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="serverListesFactures.data.api.data.queryListFactures" id="tableRepeat3" dmx-state="query1" dmx-sort="sort" dmx-order="dir">
                                            <tr>
                                                <td>Cell</td>
                                                <td colspan="">pas de donnees</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>




                            </div>
                        </div>






                    </div>
                </div>
            </div>
            <div class="col-12 mt-1">
                <div class="card small lh-1 bg-light pt-0" style="height:11vh">
                    <div class="card-body small lh-1">
                        <div class="row row-cols-7 pt-0 pb-0">
                            <div class="col-9 small lh-1 align-self-end pt-1 pb-0">
                                <div class="row border-dark row-cols-8 lh-1 rounded-1 pt-0 pb-0">
                                    <div class="ps-0 pe-2 col-2">
                                        <div class="form-group mb-0 col style237 fw-bolder">
                                            <label for="input2" class="form-label">Montant&nbsp;</label>
                                            <input type="number" class="form-control  form-control-sm" id="input_MontantCheque" name="input6" aria-describedby="input2_help" placeholder="0" dmx-bind:value="varCheque.value">
                                        </div>
                                    </div>
                                    <div class="ps-0 col-2 visually-hidden">
                                        <div class="form-group mb-3">
                                            <label for="input_Solde" class="form-label">Montant Liquide</label>
                                            <input type="number" class="form-control  style121" id="input_MontantLiquide" name="input10" aria-describedby="input4_help" placeholder="0" dmx-bind:value="varLiquide.value">
                                        </div>
                                    </div>
                                    <div class="col-2 fw-bolder ps-0 pe-2">
                                        <div class="form-group mb-3 col style238">
                                            <label for="input_Montant" class="form-label">Monde Paiment</label><select id="Mode_Paiment" class="form-select form-select-sm" dmx-bind:options="table_valeur.data.NewDataSet.tv.where(`CODE_TABLE`, 'MPMT', '==')" optiontext="LIB_LONG" optionvalue="ID_LIGNE">
                                            </select>

                                        </div>
                                    </div>
                                    <div class="ms-0 ps-0 pe-2 col-2 fw-bolder">
                                        <div class="form-group mb-3 style239">
                                            <label for="input5" class="form-label">Banque</label>
                                            <select id="banque" class="form-select form-select-sm" is="dmx-select" dmx-bind:options="listBanque.data.custom" optiontext="lib_long" optionvalue="id_ligne" dmx-bind:disabled="Mode_Paiment.value!=60">
                                            </select>
                                        </div>
                                    </div>





                                    <div class="ms-0 ps-0 pe-2 col-2 fw-bolder">
                                        <div class="form-group mb-3 style242">
                                            <label for="input_Montant" class="form-label">N°Document</label>
                                            <input type="text" class="form-control form-control-sm" id="input_NumDoc" name="input9" aria-describedby="input3_help">
                                        </div>
                                    </div>


                                    <div class="ms-0 ps-0 pe-2 col-2 fw-bolder">
                                        <div class="form-group mb-3 style243">
                                            <label for="input_Solde" class="form-label">Total Montant</label><input type="number" class="form-control  form-control-sm" id="input_MontantTotal" name="input7" aria-describedby="input4_help" placeholder="0" dmx-bind:value="(ServerBatchEncc1.data.header[0].debit - ServerBatchEncc1.data.header[0].credit)" readonly="true" dmx-on:click="toggle_for_dropMenu.check()">


                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="col">
                                <div class="row border-secondary lh-1 align-items-baseline pt-0 pb-0">
                                    <div class="text-end col-12 fw-bolder align-self-end">
                                        <div class="form-group">
                                            <div class="form-check style229 form-check-inline">
                                                <input class="form-check-input" type="checkbox" value="" id="input8" name="input8" checked="">
                                                <label class="form-check-label" for="checkbox_de">Imprimer Recu</label>
                                            </div><button id="btn1" class="btn fw-bold lh-lg text-uppercase text-white bg-success btn-sm small w-50" dmx-on:click="run([{runJS:{name:'load',outputType:'text',function:'load'}},{run:{outputType:'text',action:`SP_encaissement.load({id_piece: id_piece.value, argmt_cash: varLiquide.value, argmt_cheque: varCheque.value, argno_doc: input_NumDoc.value, argbanque: select1.value, argusermaj: 47433, argmvtpaye_tx: VarListFactures.value.replace(\'&quot;\', \'\'), arg_montant: input_MontantTotal.value, argno_contrat: id_contrat.value, arg_solde: form2.input_Solde.value})`}},{run:{outputType:'text',action:`modal1.toggle()`}},{run:{outputType:'text',action:`SP_encaissement.reset()`}},{run:{outputType:'text',action:`notifies1.success(SP_encaissement.lastError.response)`}},{run:{outputType:'text',action:`notifies1.warning(ServerBatchEncc1.lastError.message)`}}])">Mise A&nbsp; Jour</button>
                                        </div>


                                    </div>
                                </div>
                            </div>



                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <meta name="ac:route" content="/Encaissement/ENC_Diver_Multiple">
</div>

<script>
    function load()
    {

     var t = 0;
    let tmp_mvtpaye_tx = "";
    // Get the table element
   
       
       const table = document.getElementById('tableRepeat1');

      // Loop through rows (starting from 1 to skip the header)
       if (table && table.rows.length > 0 && table.rows[0].cells.length > 0) 
       {
       
           for (let i = 0; i < table.rows.length; i++) 
         {
           // Get the row
           let row = table.rows[i];
           // Get data from cells
           let trid = row.cells[0].innerHTML;
             //date: (row.getElementsByTagName('td')[2]).innerHTML,
            // libelle_Type_Mvt: (row.getElementsByTagName('td')[3]).innerHTML,
            let debit = row.cells[3].innerHTML;
            let  credit = row.cells[4].innerHTML;
            let typeMvt = row.cells[8].innerHTML;
            let montant = row.cells[5].innerHTML;
            let type_mvt_portefeuille =row.cells[6].innerHTML;
            let ligneno = row.cells[7].innerHTML;
            let id_contrat = row.cells[11].innerHTML;
            let solde = row.cells[12].innerHTML;
            let arg_possition = row.cells[13].innerHTML;
            let arg_suivi_proc_contrat = row.cells[14].innerHTML;
  
           // Log the data
            console.log(`Name: ${trid}, Age: ${debit}`);

             tmp_mvtpaye_tx +=typeMvt+"§"+trid+"§"+type_mvt_portefeuille+"§"+ligneno+"§"+arg_possition+  "§"+arg_suivi_proc_contrat+ "¿"

             dmx.parse("content.VarListFactures.setValue('"+JSON.stringify(tmp_mvtpaye_tx)+"')");
             dmx.parse("content.id_contrat.setValue('"+id_contrat+"')");
         }
        }
        else {
            console.log (table.rows[0].cells.length )
        }

             
    console.log (tmp_mvtpaye_tx ) 
  
  }

    document.getElementById("liquide_Menu").onclick = function(){liquide()};
    document.getElementById("cheque_Menu").onclick = function(){cheque()};
     // var btnMiseajour = document.getElementById("btn4");
  
     t = document.getElementById('input_MontantTotal').value ;

    function liquide()
    {

       if (parseInt(document.getElementById("input_MontantTotal").value)>0)
      {
         // document.getElementById("input_MontantCheque").value=0;
             dmx.parse('content.varCheque.setValue(' + 0 + ')')
      dmx.parse('content.varLiquide.setValue(' + document.getElementById('input_MontantTotal').value+ ')')  ;
  
        console.log( 'cheque '+dmx.app.data.content.varCheque.value )
      }
      }
    function cheque()
      {
        if (parseInt(document.getElementById("input_MontantTotal").value)>0)
       {
        // document.getElementById("input_MontantLiquide").value = 0;
          dmx.parse('content.varLiquide.setValue(' + 0 + ')')
        dmx.parse('content.varCheque.setValue(' + document.getElementById('input_MontantTotal').value+ ')') 

        console.log( 'liquide '+dmx.app.data.content.varLiquide.value )
       }
      }

   /*window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
  }*/
  
   console.log(355 + t)


// Close the dropdown if the user clicks outside of it

</script>