/*!
 DMXzone Lightbox
 Version: 2.0.0
 (c) 2024 Wappler.io
 @build 2024-04-15 17:48:46
 */
!function(e){"use strict";var t,n,o={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",events:{change:"fullscreenchange",error:"fullscreenerror"}},webkit:{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}},moz:{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",events:{change:"mozfullscreenchange",error:"mozfullscreenerror"}},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",events:{change:"MSFullscreenChange",error:"MSFullscreenError"}}},i=o.w3;for(n in o)if(o[n].enabled in e){t=o[n];break}function r(t,n){var o=e.createEvent("Event");o.initEvent(t,!0,!1),n.dispatchEvent(o)}function l(n){return function(o,r){n!==i.exit||e[t.element]?(e.addEventListener(t.events.change,(function n(){o(),e.removeEventListener(t.events.change,n,!1)}),!1),e.addEventListener(t.events.error,(function n(){r(new TypeError),e.removeEventListener(t.events.error,n,!1)}),!1)):setTimeout((function(){r(new TypeError)}),1)}}!(i.enabled in e)&&t&&(e.addEventListener(t.events.change,(function(n){n.stopPropagation(),n.stopImmediatePropagation(),e[i.enabled]=e[t.enabled],e[i.element]=e[t.element],r(i.events.change,n.target)}),!1),e.addEventListener(t.events.error,(function(e){r(i.events.error,e.target)}),!1),e[i.enabled]=e[t.enabled],e[i.element]=e[t.element],e[i.exit]=function(){var n=e[t.exit]();return!n&&window.Promise?new Promise(l(i.exit)):n},Element.prototype[i.request]=function(){var e=this[t.request].apply(this,arguments);return!e&&window.Promise?new Promise(l(i.request)):e})}(document),function(){"use strict";var e,t,n,o,i,r,l,s;dmx.lightbox={count:0,gallery:{},options:{fullscreen:!1,noscrollbars:!1,autoplay:!1,loopvideo:!1,buttons:"auto",animation:"slide",spinner:"Spinner1"}};var a="dmxLightbox",d={count:0};function u(){if(c()){for(var t=e.getElementsByTagName("video"),n=0;n<t.length;n++)t[n].paused||t[n].pause();dmx.lightbox.options.noscrollbars&&(document.documentElement.style.removeProperty("overflow"),document.body.style.removeProperty("overflow")),document.removeEventListener("keydown",E),e.classList.remove(a+"Visible"),setTimeout((function(){e.style.removeProperty("display"),document.fullscreenElement&&document.exitFullscreen(),dmx.lightbox.component&&dmx.lightbox.component.dispatchEvent("hide")}),500),r.focus()}}function c(){return"block"===e.style.display}function m(){s>=1?(s--,b(),f(s)):"none"!==dmx.lightbox.options.animation&&(t.classList.add(a+"BounceLeft"),setTimeout((function(){t.classList.remove(a+"BounceLeft")}),400))}function p(){s<=l.images.length-2?(s++,b(),h(s)):"none"!==dmx.lightbox.options.animation&&(t.classList.add(a+"BounceRight"),setTimeout((function(){t.classList.remove(a+"BounceRight")}),400))}function f(e){v(e-1,(function(){f(e-1)}))}function h(e){v(e+1,(function(){h(e+1)}))}function g(){"hide"!==dmx.lightbox.options.buttons?n.focus():i.focus()}function v(t,n){var o=l.images[t],i=l.nodes[t];if(o&&i){var r=o.getElementsByTagName("figure")[0];if(r&&r.getAttribute("url")==i.href){if(n&&n(),dmx.lightbox.options.autoplay)for(var d=e.getElementsByTagName("video"),u=0;u<d.length;u++)d[u]==o.querySelector("video")?d[u].play():d[u].paused||d[u].pause()}else{r&&r.parentNode.removeChild(r);var c=T("figure",{id:a+"Figure"+t,url:i.href}),m=T("div",{class:q("Spinner",dmx.lightbox.options.spinner)});c.appendChild(m),i.title&&c.appendChild(T("figcaption",{id:a+"Caption"+t},i.title));var p="image";if(i.hasAttribute("data-type"))p=i.getAttribute("data-type");else{var f=i.href;window.URL&&(f=new URL(i.href).pathname),/\.(avi|mp4|mov|og[mvg]|webm)$/i.test(f)&&(p="video")}if("image"==p){var h=T("img");h.onload=function(){c.removeChild(m),n&&n()},h.setAttribute("src",i.href),c.appendChild(h)}else if("video"==p){var g=T("video");g.controls=!0,g.loop=dmx.lightbox.options.loopvideo;var v=T("source",{src:i.href});g.addEventListener("canplay",(function e(){g.removeEventListener("canplay",e),c.removeChild(m),n&&n(),dmx.lightbox.options.autoplay&&s===t&&g.play()})),g.appendChild(v),c.appendChild(g)}else c.appendChild(T("div",{},'<a href="'+i.href+'">Url not supported</a>')),c.removeChild(m),n&&n();o.appendChild(c)}}}function b(){var e="translate3d("+100*-s+"%,0,0)";"fade"===dmx.lightbox.options.animation?(t.style.setProperty("opacity",0),setTimeout((function(){t.style.setProperty("transform",e),t.style.setProperty("opacity",1)}),400)):t.style.setProperty("transform",e)}function x(t){c()&&!e.contains(t.target)&&(t.stopPropagation(),g())}function y(e){document.fullscreenElement||u()}function E(e){switch(e.keyCode){case 37:m();break;case 39:p();break;case 27:u()}}function w(e){-1!==e.target.id.indexOf("dmxLightboxImage")&&u()}function L(e){e.stopPropagation(),m()}function C(e){e.stopPropagation(),p()}function S(e){e.stopPropagation(),u()}function P(e){d.count++,d.startX=e.changedTouches[0].pageX,d.startY=e.changedTouches[0].pageY}function k(e){d.count--,d.done=!1}function F(e){if(!(d.done||d.count>1)){e.preventDefault();var t=e.changedTouches[0].pageX,n=e.changedTouches[0].pageY;t-d.startX>40?(d.done=!0,m()):d.startX-t>40?(d.done=!0,p()):d.startY-n>100&&u()}}function T(e,t,n){var o=document.createElement(e);return t&&Object.keys(t).forEach((function(e){o.setAttribute(e,t[e])})),n&&(o.innerHTML=n),o}function q(){return a+[].join.call(arguments," "+a)}dmx.lightbox.register=function(e){if(dmx.lightbox.component)return console.warn("Only 1 lightbox component should be used on the page!");dmx.lightbox.component=e},dmx.lightbox.getGallery=function(e){return dmx.lightbox.gallery[e]||(dmx.lightbox.gallery[e]={nodes:[],images:[]}),dmx.lightbox.gallery[e]},dmx.lightbox.addToGallery=function(e,t){var n=dmx.lightbox.getGallery(e);-1===n.nodes.indexOf(t)&&(n.nodes.push(t),n.updated=!0)},dmx.lightbox.setOptions=function(e){dmx.lightbox.options=dmx.extend(dmx.lightbox.options,e)},dmx.lightbox.run=function(d,u){var m=dmx.lightbox.gallery[d];if(!m)return alert("Gallery "+d+" does not exist.");e||(e=T("div",{class:q("Overlay"),role:"dialog"}),t=T("div",{class:q("Slider")}),n=T("button",{class:q("Button","Prev"),type:"button","aria-label":"Previous"}),o=T("button",{class:q("Button","Next"),type:"button","aria-label":"Next"}),i=T("button",{class:q("Button","Close"),type:"button","aria-label":"Close"}),e.appendChild(t),e.appendChild(n),e.appendChild(o),e.appendChild(i),document.body.appendChild(e),document.addEventListener("focus",x,!0),document.addEventListener("fullscreenchange",y),e.addEventListener("click",w),n.addEventListener("click",L),o.addEventListener("click",C),i.addEventListener("click",S),e.addEventListener("touchstart",P),e.addEventListener("touchend",k),e.addEventListener("touchmove",F)),function(i){l=i,function(){var e=dmx.extend(dmx.lightbox.options);t.style.transition="fade"===e.animation?"opacity .4s ease":"slide"===e.animation?"":"none","auto"!==e.buttons||!("ontouchstart"in window)&&1!==l.nodes.length||(e.buttons="hide");n.style.display=o.style.display="hide"===e.buttons?"none":""}();for(;t.firstChild;)t.removeChild(t.firstChild);i.nodes=i.nodes.filter((function(e){var t=document.body.contains(e);return t||(i.updated=!0),t})),i.updated&&(i.images=[],i.updated=!1);for(var r=[],s=[],d=0;d<i.nodes.length;d++)i.images[d]||i.images.push(T("div",{id:a+"Image"+d,class:a+"Image"})),r.push(a+"Figure"+d),s.push(a+"Caption"+d),t.appendChild(i.images[d]);e.setAttribute("aria-labelledby",r.join(" ")),e.setAttribute("aria-describedby",s.join(" "))}(m),function(t){dmx.lightbox.options.noscrollbars&&(document.documentElement.style.setProperty("overflow","hidden"),document.body.style.setProperty("overflow","scroll"));if(c())return;document.addEventListener("keydown",E),s=t,v(t,(function(){h(t),f(t)})),b(),e.style.setProperty("display","block"),dmx.lightbox.options.fullscreen&&e.requestFullscreen&&e.requestFullscreen();setTimeout((function(){e.classList.add(a+"Visible"),dmx.lightbox.component&&dmx.lightbox.component.dispatchEvent("show")}),50),r=document.activeElement,g()}(m.nodes.indexOf(u))}}(),dmx.Component("lightbox",{attributes:{fullscreen:{type:Boolean,default:!1},noscrollbars:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1},loopvideo:{type:Boolean,default:!1},buttons:{type:String,default:"auto",enum:["auto","show","hide"]},animation:{type:String,default:"slide",enum:["slide","fade","none"]},spinner:{type:String,default:"Spinner1",enum:["Spinner1","Spinner2","Spinner3","Spinner4","Spinner5","Spinner6","Spinner7","Spinner8"]}},events:{show:Event,hide:Event},init(e){dmx.lightbox.register(this)},performUpdate(e){dmx.lightbox.setOptions(this.props)}}),dmx.Attribute("lightbox","mounted",(function(e,t){var n=t.argument||"dmxImage"+ ++dmx.lightbox.count;dmx.lightbox.addToGallery(n,e),e.addEventListener("click",(function(t){t.preventDefault(),dmx.lightbox.run(n,e)}))}));
//# sourceMappingURL=dmxLightbox.js.map
